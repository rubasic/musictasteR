---
title: "plot_time_avg"
author: "Clara Dionet"
date: '2018-12-07'
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```


```{r}
  library(tidyverse)
  library(spotifyr)
  library(dplyr)
  library(tidyverse)
  library(httr)
  library(stringr)
  library(billboard)
  library(reshape)
```

```{r}

chart_df <- billboard::spotify_track_data
nonchart_df <- read_csv("avg_across_years_summary.csv")
nonchart_df <- nonchart_df %>% select(-"X1")
colnames(nonchart_df) <- c("year", "danceability","energy","key","loudness","mode","speechiness","acousticness","instrumentalness","liveness","valence","tempo" )
# for now select values between 0-1 only 
nonchart_df <- nonchart_df %>%  select(-c("key","loudness"))
#  plot_avg <- function(vars, boxplot, timerange) {
#    if(boxplot == FALSE) {
    # get mean for each attribute

# if function for yes plot for non billboard

timerange = c(1960,2015)
vars <- c("danceability" ,"energy" ,"mode", "speechiness","acousticness", "instrumentalness" ,"liveness","valence" ,"tempo")
    df_avg <- aggregate(chart_df[,vars], list(chart_df$year), mean)
    colnames(df_avg)[1] <- "year"
    # reshape function for plot
    
    # df melt has average of all variables per year
    df_melt <- melt(as.data.frame(df_avg), id = "year")
    df_melt_non_chart <- melt(as.data.frame(nonchart_df),id="year")
    df_melt$chart <- "Billboard"
    df_melt_non_chart$chart <- "Non Billboard"
    df <- rbind(df_melt,df_melt_non_chart)
    # make continuous
    df$year <- as.numeric(as.character(df$year))
    ggplot(df, aes(x=year, y=value, color=variable, linetype = chart)) + ylim(0,1)  + geom_line(size=1) + xlim(timerange)
    # year should be continuous
    df_melt$year <- as.numeric(as.character(df_melt$year))
    ggplot(df_melt, aes(x=year, y=value, color=variable)) + ylim(0,1)  + geom_line(size=1) + xlim(timerange)
    
#   }
#    else {
      df_time <- as.data.frame(df) %>% filter(year %in% timerange[1]:timerange[2])
      df_box_melt <- melt(df_time,id.vars="year", measure.vars=vars)
      ggplot(df_box_melt) + geom_boxplot(aes(x=year, y=value, fill=variable)) + theme(axis.text.x = element_text(angle=90)) + ylim(0,1)  
#    }
  }
```

